---

title: Accelerated Failure Time Models


keywords: fastai
sidebar: home_sidebar

summary: "AFT Model theory."
description: "AFT Model theory."
nb_path: "60_AFT_models.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 60_AFT_models.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can model the time to failure as:
$$
\log T_i = \mu + \xi_i
$$
where $\xi_i\sim p(\xi|\theta)$ and $\mu$ is the most likely log time of death (the mode of the distribution of $T_i$). We model log death as that way we do not need to restrict $\mu + \xi_i$ to be positive.</p>
<p>In the censored case, where $t_i$ is the time where an instance was censored, and $T_i$ is the unobserved time of death, we have:
$$
\begin{aligned}
\log T_i &amp;= \mu(x_i) + \xi_i &gt; \log t_i\\
\therefore \xi_i &amp;&gt; \log t_i - \mu(x_i)
\end{aligned}
$$
Note that $\mu$ is a function of the features $x$. The log likelihood of the data ($\mathcal{D}$) can then shown to be:
$$
\begin{aligned}
\log p(\mathcal{D}) = \sum_{i=1}^N \mathcal{1}(y_i=1)\log p(\xi_i = \log t_i - \mu(x_i)) + \mathcal{1}(y_i=0)\log p(\xi_i &amp;&gt; \log t_i - \mu(x_i))
\end{aligned}
$$</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AFTModel" class="doc_header"><code>class</code> <code>AFTModel</code><a href="https://github.com/sachinruk/torchlife/tree/master/torchlife/models/aft.py#L16" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AFTModel</code>(<strong><code>distribution</code></strong>:<code>str</code>, <strong><code>input_dim</code></strong>:<code>int</code>, <strong><code>h</code></strong>:<code>tuple</code>=<em><code>()</code></em>) :: <code>Module</code></p>
</blockquote>
<p>Accelerated Failure Time model
parameters:</p>
<ul>
<li>Distribution of which the error is assumed to be</li>
<li>dim (optional): input dimensionality of variables</li>
<li>h (optional): number of hidden nodes</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Modelling based on <strong>only</strong> time and (death) event variables:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># import pandas as pd</span>

<span class="c1"># url = &quot;https://raw.githubusercontent.com/vincentarelbundock/Rdatasets/master/csv/survival/flchain.csv&quot;</span>
<span class="c1"># df = pd.read_csv(url).iloc[:,1:]</span>
<span class="c1"># df.rename(columns={&#39;futime&#39;:&#39;t&#39;, &#39;death&#39;:&#39;e&#39;}, inplace=True)</span>

<span class="c1"># cols = [&quot;age&quot;, &quot;sample.yr&quot;, &quot;kappa&quot;]</span>
<span class="c1"># db, t_scaler, x_scaler = create_dl(df[[&#39;t&#39;, &#39;e&#39;] + cols])</span>

<span class="c1"># death_rate = 100*df[&quot;e&quot;].mean()</span>
<span class="c1"># print(f&quot;Death occurs in {death_rate:.2f}% of cases&quot;)</span>
<span class="c1"># print(df.shape)</span>
<span class="c1"># df.head()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># from fastai.basics import Learner</span>
<span class="c1"># from torchlife.losses import aft_loss</span>

<span class="c1"># model = AFTModel(&quot;Gumbel&quot;, t_scaler, x_scaler)</span>
<span class="c1"># learner = Learner(db, model, loss_func=aft_loss)</span>
<span class="c1"># # wd = 1e-4</span>
<span class="c1"># learner.lr_find(start_lr=1, end_lr=10)</span>
<span class="c1"># learner.recorder.plot()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

